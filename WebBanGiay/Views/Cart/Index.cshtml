﻿﻿@model IEnumerable<WebBanGiay.Models.Cart>


@{
    ViewBag.Title = "Index";
    ViewBag.page = "Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Tong = 0;
    WebBanGiay.Models.vietnamese_administrative_unitsEntities vn = new WebBanGiay.Models.vietnamese_administrative_unitsEntities();
    var Customer = (WebBanGiay.Models.User)HttpContext.Current.Session["Customer"];

}
@section Style
    {
    <style>
        /* Hide arrows in Chrome, Safari, Edge, and Opera */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Hide arrows in Firefox */
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>

}

<!--================Cart Area =================-->
<section class="cart_area">
    <div class="container">
        <div class="cart_inner">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Product</th>
                            <th scope="col">Size</th>
                            <th scope="col">Price</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Total</th>
                            <th scope="col"></th>

                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null)
                        {

                            foreach (var item in Model)
                            {


                                var product = new WebBanGiay.Models.WebBanGiayEntities().Products.SingleOrDefault(m => m.Product_Id == item.Product_Id);

                                <tr>
                                    <form id="Form-@item.Product_Id-@item.Size" action="~/Cart/UpdateCart" method="post">

                                    <td>
                                        <div class="media">
                                            <div class="d-flex">
                                                <img style="height:100px; width:150px" src="~/Areas/Admin/Data/@product.Product_Image" />
                                            </div>
                                            <div class="media-body">
                                                <p>@product.Product_Name</p>
                                            </div>
                                        </div>
                                    </td>

                                    <td>
                                        <div class="media">

                                            <div class="media-body">
                                                <p>@item.Size</p>
                                            </div>
                                        </div>
                                    </td>

                                    <td>
                                        <h5>
                                            @{
                                                int price = Convert.ToInt32(product.Product_Price);
                                                string formattedPrice = price.ToString("N0", new System.Globalization.CultureInfo("vi-VN"));
                                                <span>@formattedPrice₫</span>

                                            }
                                        </h5>
                                    </td>
                                    <td>
                                        <div class="product_count">
                                            <input type="number" name="Quantity" id="sst-@item.Product_Id-@item.Size" maxlength="12" value="@item.Quantity" title="Quantity:"
                                                   class="input-text qty">
                                            <button onclick="increaseQuantity('@item.Product_Id','@item.Size')" class="increase items-count" type="button">
                                                <i class="lnr lnr-chevron-up"></i>
                                            </button>
                                            <button onclick="decreaseQuantity('@item.Product_Id','@item.Size')" class="reduced items-count" type="button">
                                                <i class="lnr lnr-chevron-down"></i>
                                            </button>
                                        </div>

                                    </td>
                                    <td>
                                        <h5>
                                            @{
                                                int price1 = Convert.ToInt32(product.Product_Price * item.Quantity);
                                                string formattedPrice1 = price1.ToString("N0", new System.Globalization.CultureInfo("vi-VN"));
                                                <span>@formattedPrice1₫</span>
                                                ViewBag.Tong = ViewBag.Tong + price1;
                                            }
                                        </h5>

                                    </td>
                                    <td>
                                        <h5>
                                            <a href="#" class="genric-btn danger-border circle">Xóa</a>
                                        </h5>

                                    </td>
                                    </form>
                                </tr>


                            }
                        }
                        <tr class="bottom_button">
                            <td>
                                <a class="gray_btn" href="#">Update Cart</a>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                                <div class="cupon_text d-flex align-items-center">
                                    <input type="text" placeholder="Coupon code">
                                    <a class="primary-btn" href="#">Apply</a>
                                    <a class="gray_btn" href="#">Close Coupon</a>
                                </div>
                            </td>
                        </tr>

                        <tr>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                                <h5>Subtotal</h5>
                            </td>
                            <td>
                                <h5>
                                    @{
                                        int price2 = Convert.ToInt32(ViewBag.Tong);
                                        string formattedPrice2 = price2.ToString("N0", new System.Globalization.CultureInfo("vi-VN"));
                                        <span>@formattedPrice2₫</span>
                                    }

                                </h5>
                            </td>
                        </tr>

                        <tr class="out_button_area">
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                                <div class="checkout_btn_inner d-flex align-items-center">
                                    <a class="gray_btn" href="~/Shop/index">Tiếp tục mua</a>
                                    <a class="primary-btn" href="/Cart/CheckOut">Thanh toán</a>


                                </div>
                            </td>
                        </tr>
                        <h3 class="text-danger">
                            @TempData["Message"]
                        </h3>


                    </tbody>

                </table>
            </div>
        </div>
    </div>
    <script>
        function increaseQuantity(productId, size) {
            var result = document.getElementById('sst-' + productId + '-' + size);
            if (result == null) {
                console.log('Không có')
                return;
            }
            var sst = result.value;
            if (!isNaN(sst)) {
                result.value++;
                document.getElementById('Form' + productId + '-' + size).submit();

            }

            return false;
        }

        function decreaseQuantity(productId, size) {
            var result = document.getElementById('sst-' + productId + '-' + size);
            if (result == null) {
                console.log('Không có')
                return;
            }
            var sst = result.value;
            if (!isNaN(sst) && sst > 0) {
                result.value--;
                document.getElementById('Form' + productId + '-' + size).submit();

            }

            return false;
        }
    </script>

</section>

<!--================End Cart Area =================-->
@section Script{



    <script>

        jq360(document).ready(function () {
            // Khi người dùng chọn một tỉnh
            jq360('#province').change(function () {
                jq360.get("/Cart/GetDistricts", { province_code: jq360("#province").val() }, function (data) {
                    jq360("#district").empty();
                    jq360.each(data, function (index, row) {
                        jq360("#district").append("<option value='" + row.code + "'>" + row.full_name + "</option>")
                    })
                });


            });


            jq360('#district').change(function () {
                jq360.get("/Cart/GetWards", { district_code: jq360("#district").val() }, function (data) {
                    console.log(jq360("#district").val())
                    jq360("#ward").empty();
                    jq360.each(data, function (index, row) {
                        jq360("#ward").append("<option value='" + row.code + "'>" + row.full_name + "</option>")
                        console.log("<option value='" + row.code + "'>" + row.full_name + "</option>")
                    })
                });


            });
        });
    </script>
}